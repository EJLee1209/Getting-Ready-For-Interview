# 주소창에 https://www.google.com 을 입력하고 엔터를 누르면 일어나는 일

## 1. DNS 캐싱 확인
- 사용자가 입력한 주소에서 도메인 네임인 www.google.com을 뽑아냅니다.
- 브라우저에 캐싱된 DNS 중 해당 도메인 네임이 있는지 확인합니다. 있다면 번으로 이동합니다.
- 컴퓨터의 etc/hosts 파일을 확인해보고 맵핑된 ip 주소가 있는지 확인합니다. 있다면 3번으로 이동합니다.
- 라우터에 캐싱된 DNS 중 해당 도메인 네임이 있는지 확인합니다. 있다면 3번으로 이동합니다.
- ISP에 캐싱된 DNS 중 해당 도메인 네임이 있는지 확인합니다. 있다면 3번으로 이동합니다.

## 2. DNS 쿼리 요청 
- 브라우저는 로컬 DNS 서버에 도메인 네임을 포함한 쿼리를 요청합니다. 
- 로컬 DNS 서버는 루트 네임 서버로 도메인 네임을 포함한 쿼리를 요청합니다.
- 루트 네임 서버는 `.com` 루트 네임을 관리하는 TLD(Top Level Domain name)서버의 ip주소로 응답합니다.
- 로컬 DNS 서버는 TLD 서버로 도메인 네임을 포함한 쿼리를 요청합니다. 
- TLD 서버는 `www.google.com`을 관리하는 책임 DNS 서버의 ip주소로 응답합니다.
- 로컬 네임 서버는 책임 DNS 서버에 도메인 네임을 포함한 쿼리를 요청합니다.
- 책임 DNS 서버는 `www.google.com`에 대한 ip주소로 응답합니다.
- 로컬 네임 서버는 응답으로 받은 ip주소를 브라우저에 반환합니다.

## 3. 3-Way-Handshake
- 요청을 보낼 ip 주소와 3 way handshake를 통해 TCP 연결을 설정합니다. 
- 먼저 알아낸 ip 주소로 TCP헤더의 SYN 플래그가 활성화된 패킷을 전송합니다.
- 잠시 후에 SYN과 ACK이 활성화된 패킷을 응답으로 받으면 ACK 플래그가 활성화된 패킷을 전송하고 연결을 확정합니다.

## 4. SSL Handshake
- 클라이언트는 서버에 client hello 메세지를 보냅니다. 이때 랜덤한 데이터를 생성하여 함께 보냅니다.
- 서버는 요청을 받은 뒤 server hello 로 응답하면서 인증서와 암호화 방식, 서버에서 랜덤하게 생성한 데이터를 응답으로 전달합니다.
- 클라이언트는 서버가 보낸 인증서가 CA에 의해 발급된 인증서인지 확인합니다. 유효한 인증서라면 클라이언트는 주고받은 랜덤한 데이터로 대칭키를 생성한 뒤 인증서에 포함된 공개키로 대칭키를 암호화하여 서버에 전송합니다. 이제 이 대칭키는 서버에서만 복호화가 가능합니다.
- 서버는 자신이 가진 개인키로 암호화된 대칭키를 복호화합니다.
- 이제 양쪽 호스트는 모두 대칭키를 가지게 되었고 이 키를 사용하여 통신시 전달되는 데이터를 암호화하고 복호화합니다.

## 5. 데이터 요청과 응답
- 이제 서버로 www.google.com에 대한 웹 페이지를 요청합니다.
- 서버는 요청을 받고 응답으로 google.com/index.html 을 데이터로 담아 전송합니다.

## 6. 웹페이지 처리
- 웹페이지를 응답으로 받은 브라우저는 html을 해석해서 추가적인 리소스가 필요하다면 다시 서버로 요청을 보내면서 화면을 그리게됩니다.
